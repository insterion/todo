<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏—Ç–µ –ó–∞–¥–∞—á–∏</title>
    <style>
        body { background-color: #121212; color: #ffffff; font-family: sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .box { width: 100%; max-width: 400px; margin-bottom: 15px; }
        input { width: 100%; padding: 15px; background: #1e1e1e; border: 1px solid #333; color: white; border-radius: 8px; font-size: 16px; margin-bottom: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; border-radius: 8px; font-size: 18px; font-weight: bold; border: none; cursor: pointer; }
        .btn-add { background: #BB86FC; color: #000; }
        .btn-test { background: orange; color: #000; margin-top: 20px; }
        .log-area { background: #222; color: yellow; padding: 10px; font-family: monospace; font-size: 12px; width: 100%; border: 1px solid #444; margin-top: 20px; }
        .task-item { background: #1e1e1e; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid #BB86FC; }
    </style>
</head>
<body>

    <h1>‚úÖ –ó–∞–¥–∞—á–∏ (PWA)</h1>

    <div class="box">
        <input type="text" id="taskDesc" placeholder="–ó–∞–¥–∞—á–∞...">
        <input type="time" id="taskTime">
        <button onclick="addTask()" class="btn-add">–î–æ–±–∞–≤–∏ –ó–∞–¥–∞—á–∞</button>
    </div>

    <div id="taskList" class="box"></div>

    <button onclick="testNotification()" class="btn-test">üîî –¢–ï–°–¢ –ò–ó–í–ï–°–¢–ò–ï</button>
    <div id="logs" class="log-area">–õ–æ–≥ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞...</div>

    <script>
        // 1. –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ù–ê SERVICE WORKER (–ó–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ –∑–∞ –ê–Ω–¥—Ä–æ–∏–¥!)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => log("Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω!"))
                .catch(err => log("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ SW: " + err));
        }

        let tasks = [];
        
        // –ü–æ–∑–≤–æ–ª—è–≤–∞ –∏–∑–≤–µ—Å—Ç–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç
        Notification.requestPermission();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Å–µ–∫–∏ 10 —Å–µ–∫—É–Ω–¥–∏
        setInterval(checkReminders, 10000);

        function log(text) {
            const el = document.getElementById('logs');
            el.innerHTML = text + "<br>" + el.innerHTML;
        }

        function addTask() {
            const desc = document.getElementById('taskDesc').value;
            const time = document.getElementById('taskTime').value;
            if(!desc || !time) return alert("–ü–æ–ø—ä–ª–Ω–∏ –≤—Å–∏—á–∫–æ!");
            
            tasks.push({ desc, time, notified: false });
            renderTasks();
            log("–î–æ–±–∞–≤–µ–Ω–æ: " + desc + " –∑–∞ " + time);
        }

        function checkReminders() {
            const now = new Date();
            const currentTime = String(now.getHours()).padStart(2,'0') + ":" + String(now.getMinutes()).padStart(2,'0');
            
            tasks.forEach(task => {
                if (task.time === currentTime && !task.notified) {
                    showNotification(task.desc);
                    task.notified = true;
                }
            });
        }

        // –ù–û–í–ê–¢–ê –§–£–ù–ö–¶–ò–Ø –ó–ê –ò–ó–í–ï–°–¢–ò–Ø
        function showNotification(text) {
            log("–û–ø–∏—Ç–≤–∞–º –¥–∞ –ø—Ä–∞—Ç—è –∏–∑–≤–µ—Å—Ç–∏–µ: " + text);
            
            if (Notification.permission === 'granted') {
                navigator.serviceWorker.ready.then(registration => {
                    registration.showNotification('–ù–∞–ø–æ–º–Ω—è–Ω–µ!', {
                        body: text,
                        icon: 'https://cdn-icons-png.flaticon.com/512/762/762686.png',
                        vibrate: [200, 100, 200]
                    });
                    log("–ò–∑–≤–µ—Å—Ç–∏–µ—Ç–æ –µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–æ –∫—ä–º Android!");
                }).catch(e => log("–ì–†–ï–®–ö–ê –ø—Ä–∏ –ø—Ä–∞—â–∞–Ω–µ: " + e));
            } else {
                log("–ù—è–º–∞ –ø—Ä–∞–≤–∞! –°—Ç–∞—Ç—É—Å: " + Notification.permission);
                Notification.requestPermission();
            }
        }

        function testNotification() {
            showNotification("–¢–æ–≤–∞ –µ —Ä—ä—á–µ–Ω —Ç–µ—Å—Ç!");
        }

        function renderTasks() {
            document.getElementById('taskList').innerHTML = tasks.map(t => 
                `<div class="task-item">‚è∞ ${t.time} - ${t.desc}</div>`
            ).join('');
        }
    </script>
</body>
</html>
