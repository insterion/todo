<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—è—Ç –û—Ä–≥–∞–Ω–∞–π–∑–µ—Ä</title>
    <style>
        body { 
            background-color: #121212; 
            color: #ffffff; 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        h1 { color: #BB86FC; margin-bottom: 20px; }
        
        .input-group {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        input {
            padding: 12px;
            background: #2c2c2c;
            border: 1px solid #333;
            color: white;
            border-radius: 8px;
            font-size: 16px;
        }
        
        button.add-btn {
            background: #BB86FC;
            color: #000;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            margin-top: 5px;
        }

        #taskList {
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
        }

        .task-card {
            background: #1e1e1e;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid #03dac6;
        }

        .task-info { display: flex; flex-direction: column; }
        .task-time { font-weight: bold; color: #03dac6; font-size: 1.1em; }
        .task-desc { margin-top: 4px; color: #ddd; }

        .actions button {
            background: none;
            border: none;
            font-size: 1.2em;
            padding: 5px 10px;
            margin-left: 5px;
        }
    </style>
</head>
<body>

    <h1>üìÖ –ó–∞–¥–∞—á–∏ v2.0</h1>

    <audio id="alarmSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <div class="input-group">
        <input type="text" id="taskDesc" placeholder="–ö–∞–∫–≤–æ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–≤—ä—Ä—à–∞?">
        <input type="time" id="taskTime">
        <button onclick="addTask()" class="add-btn">‚ûï –î–æ–±–∞–≤–∏ –ó–∞–¥–∞—á–∞</button>
    </div>

    <div id="taskList">
        </div>

    <script>
        // 1. –ó–ê–†–ï–ñ–î–ê–ù–ï –û–¢ –ü–ê–ú–ï–¢–¢–ê (Local Storage)
        let tasks = JSON.parse(localStorage.getItem('myTasks')) || [];
        
        // –°—Ç–∞—Ä—Ç–∏—Ä–∞–º–µ Service Worker –∏ –ø–æ–∫–∞–∑–≤–∞–º–µ –∑–∞–¥–∞—á–∏—Ç–µ
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
        Notification.requestPermission();
        renderTasks();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Å–µ–∫–∏ 5 —Å–µ–∫—É–Ω–¥–∏
        setInterval(checkReminders, 5000);

        function addTask() {
            const desc = document.getElementById('taskDesc').value;
            const time = document.getElementById('taskTime').value;

            if (!desc || !time) return alert("–ú–æ–ª—è –ø–æ–ø—ä–ª–Ω–µ—Ç–µ —á–∞—Å –∏ –∑–∞–¥–∞—á–∞!");

            tasks.push({ id: Date.now(), desc, time, notified: false });
            saveTasks();
            
            // –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –ø–æ–ª–µ—Ç–∞—Ç–∞
            document.getElementById('taskDesc').value = '';
            renderTasks();
        }

        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            saveTasks();
            renderTasks();
        }

        function saveTasks() {
            // –ó–∞–ø–∏—Å–≤–∞–Ω–µ –≤ –ø–∞–º–µ—Ç—Ç–∞ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            localStorage.setItem('myTasks', JSON.stringify(tasks));
        }

        function checkReminders() {
            const now = new Date();
            const currentTime = String(now.getHours()).padStart(2,'0') + ":" + String(now.getMinutes()).padStart(2,'0');

            tasks.forEach(task => {
                // –ê–∫–æ —á–∞—Å—ä—Ç —Å—ä–≤–ø–∞–¥–∞ –ò –æ—â–µ –Ω–µ —Å–º–µ –∏–∑–≤–µ—Å—Ç–∏–ª–∏
                if (task.time === currentTime && !task.notified) {
                    
                    // 1. –ü—É—Å–∫–∞–º–µ –∏–∑–≤–µ—Å—Ç–∏–µ
                    if(Notification.permission === 'granted') {
                        navigator.serviceWorker.ready.then(reg => {
                            reg.showNotification('–ù–∞–ø–æ–º–Ω—è–Ω–µ!', {
                                body: task.desc,
                                icon: 'https://cdn-icons-png.flaticon.com/512/762/762686.png',
                                vibrate: [500, 200, 500] 
                            });
                        });
                    }

                    // 2. –û–ü–ò–¢ –ó–ê –ó–í–£–ö (–ü–ª–∞–Ω –ë)
                    document.getElementById('alarmSound').play().catch(e => console.log("–ë—Ä–∞—É–∑—ä—Ä—ä—Ç —Å–ø—Ä—è –∑–≤—É–∫–∞: " + e));

                    task.notified = true;
                    saveTasks(); // –ó–∞–ø–∏—Å–≤–∞–º–µ, —á–µ —Å–º–µ –∏–∑–≤–µ—Å—Ç–∏–ª–∏
                }
            });
        }

        function renderTasks() {
            // –°–æ—Ä—Ç–∏—Ä–∞–Ω–µ –ø–æ —á–∞—Å
            tasks.sort((a, b) => a.time.localeCompare(b.time));

            const list = document.getElementById('taskList');
            list.innerHTML = tasks.map(task => `
                <div class="task-card" style="opacity: ${task.notified ? 0.5 : 1}">
                    <div class="task-info">
                        <span class="task-time">‚è∞ ${task.time}</span>
                        <span class="task-desc">${task.desc}</span>
                    </div>
                    <div class="actions">
                        <button onclick="deleteTask(${task.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
